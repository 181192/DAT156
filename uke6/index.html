<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Uke 6 - The mad girlfriend bug | DAT156</title>
    <meta name="description" content="Praksis i arbeidslivet for data @ stacc">
    
    
    <link rel="preload" href="/DAT156/assets/css/0.styles.3fd9cd7c.css" as="style"><link rel="preload" href="/DAT156/assets/js/app.6c68b4e0.js" as="script"><link rel="preload" href="/DAT156/assets/js/4.fe756608.js" as="script"><link rel="prefetch" href="/DAT156/assets/js/10.84c11907.js"><link rel="prefetch" href="/DAT156/assets/js/11.4d4cbf79.js"><link rel="prefetch" href="/DAT156/assets/js/2.dbe23dab.js"><link rel="prefetch" href="/DAT156/assets/js/3.7fdf8996.js"><link rel="prefetch" href="/DAT156/assets/js/5.ba34f960.js"><link rel="prefetch" href="/DAT156/assets/js/6.9b20bbb8.js"><link rel="prefetch" href="/DAT156/assets/js/7.fdf1d653.js"><link rel="prefetch" href="/DAT156/assets/js/8.577025a1.js"><link rel="prefetch" href="/DAT156/assets/js/9.b81aff6f.js">
    <link rel="stylesheet" href="/DAT156/assets/css/0.styles.3fd9cd7c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/DAT156/" class="home-link router-link-active"><!----> <span class="site-name">DAT156</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/DAT156/" class="nav-link">Hjem</a></div><div class="nav-item"><a href="https://github.com/181192/DAT156" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://stacc.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Stacc
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/DAT156/" class="nav-link">Hjem</a></div><div class="nav-item"><a href="https://github.com/181192/DAT156" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://stacc.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Stacc
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/DAT156/uke6/" class="active sidebar-link">Uke 6 - The mad girlfriend bug</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DAT156/uke6/#fredag" class="sidebar-link">Fredag</a></li><li class="sidebar-sub-header"><a href="/DAT156/uke6/#torsdag" class="sidebar-link">Torsdag</a></li><li class="sidebar-sub-header"><a href="/DAT156/uke6/#mandag-tirsdag-og-onsdag" class="sidebar-link">Mandag, tirsdag og onsdag</a></li></ul></li><li><a href="/DAT156/uke5/" class="sidebar-link">Uke 5 - JWT</a></li><li><a href="/DAT156/uke4/" class="sidebar-link">Uke 4 - Dypt inn i skyene</a></li><li><a href="/DAT156/uke3/" class="sidebar-link">Uke 3 - Veien mot skyene</a></li><li><a href="/DAT156/uke2/" class="sidebar-link">Uke 2 - Postman, Azure og Kubernetes</a></li><li><a href="/DAT156/uke1/" class="sidebar-link">Uke 1 - Vue og AngularJS</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="uke-6-the-mad-girlfriend-bug-and-gitops"><a href="#uke-6-the-mad-girlfriend-bug-and-gitops" aria-hidden="true" class="header-anchor">#</a> Uke 6 - The mad girlfriend bug and GitOps</h1> <div class="tip custom-block"><p class="custom-block-title">Timer</p> <p>Denne uken: 42</p> <p><strong>Totalt: 219</strong> üéâ</p></div> <p></p><div class="table-of-contents"><ul><li><a href="#fredag">Fredag</a></li><li><a href="#torsdag">Torsdag</a><ul><li><a href="#weaveworks-flux">Weaveworks Flux</a></li><li><a href="#jetstack-cert-manager">Jetstack Cert-Manager</a></li></ul></li><li><a href="#mandag-tirsdag-og-onsdag">Mandag, tirsdag og onsdag</a></li></ul></div><p></p> <h2 id="fredag"><a href="#fredag" aria-hidden="true" class="header-anchor">#</a> Fredag</h2> <p>I dag har jeg jobbet med √• ta neste modul opp i Kubernetes, modulen kalles <em>dd_server_domain</em> og holder en oversikt over ulike domener som tilh√∏rer forskjellige banker. Denne modulen krever en database tilgang.</p> <p>Jeg startet med √• sette opp en <code>Dockerfile</code> for √• pakke modulen inn i en tomcat kontainer. Dette er samme kontaineren som jeg lagde til <em>dd_server_location</em>. Deretter fikk jeg den kontaineren til √• koble seg til en database som jeg kj√∏rte med <code>docker-compose</code>. Da var jeg sikker p√• at applikasjonen fungerte som den skulle, og det eneste som n√• m√•tte endres n√•r den kom oppi Kubernetes klusteret var milj√∏variablene for <code>jdbc-url</code>, passord og brukernavn.</p> <p>Jeg hadde ogs√• med meg konsulenten i dag. S√• han startet med √• sette opp Helm chartet, mens jeg klargjorde Docker imaget og konfigurerte Bitbucket Pipeline.</p> <p>Vi satt opp en <a href="https://docs.microsoft.com/en-us/azure/mysql/" target="_blank" rel="noopener noreferrer">Azure Database for MySQL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> instans i Azure utenfor Klusteret, og lagde en test database som vi kan bruke for test klusteret v√•rt.</p> <p>Men s√• fikk vi latterlig mye problemer med √• f√• database tilkoblingen til √• fungere. Azure Database krever SSL som standard.</p> <p>En <code>jdbc-url</code> mot en MySQL database ser typisk slik ut,</p> <div class="language- extra-class"><pre class="language-text"><code>jdbc:mysql://azure-database:3306/test?useSSL=true&amp;requireSSL=false
</code></pre></div><p>og ligger inni Tomcat <code>server.xml</code> konfigurasjonen under <code>&lt;Resource&gt;</code> taggen med flere parametre som blandt annet brukernavn, passord og <a href="https://github.com/swaldman/c3p0" target="_blank" rel="noopener noreferrer">c3p0<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> config. c3p0 er ett <em>concurrent JDBC Connection pooling library</em>.</p> <p>Det viste seg til slutt, etter <em>mye</em> googling, at database connectoren til MySQL har en bug i versjon 5.1.19 som vi brukte, med √• koble seg til databaser med SSL. Jeg oppgraderte til en nyere versjon 5.1.31 hvor dette er fikset, og vipps s√• fungerte det.</p> <p>Siden vi bruker <a href="https://www.liquibase.org/" target="_blank" rel="noopener noreferrer">Liquibase<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, bygger database skjemaet seg automatisk. Dette gj√∏r at vi ikke trenger √• definere noe skjema, vi trenger bare √• peke mot databasen s√• ordner applikasjonen resten. Ganske kult!</p> <p>S√• tweaket vi litt mer med Helm Chartet, ogs√• lot jeg Flux ta over jobben slik at vi kj√∏rer etter GitOps prinsippene.</p> <p>Time antallet for praksisfaget (216 timer) er n√• ogs√• n√•dd, s√• mulig dette er siste blogg innlegget.</p> <h2 id="torsdag"><a href="#torsdag" aria-hidden="true" class="header-anchor">#</a> Torsdag</h2> <p>I dag startet jeg endelig √• jobbe med <em>Veien til Skyen</em> prosjektet igjen. Konsulenten som har v√¶rt med meg tidligere kom i dag. I mens prosjektet har st√•tt litt stille har jeg lest en del p√• fritiden om forskjellige teknologier og verkt√∏y som h√∏rer hjemme i sky verdenen. Da kom jeg over ett konsept kalt GitOps, som stammer fra ordet DevOps.</p> <div class="tip custom-block"><p class="custom-block-title">GitOps</p> <p>GitOps er en m√•te √• gj√∏re kontinuerlig leveranse (CD). Det funger ved √• bruke Git som sannhet for deklarativ infrastruktur og applikasjoner. Deklarativ programmering betyr √• skrive kode for √• beskrive <strong>hva programmet skal gj√∏re</strong> i motsetning til <strong>hvordan det skal gj√∏re det</strong>.</p> <p>For eksempel: <em>det er 10 nginx-servere</em>, istedet for <em>start 10 nginx-servere, og fortell meg om det fungerte eller ikke</em>.</p> <p>Men ideen g√•r videre - ved hjelp av verkt√∏y for √• se p√• den faktiske tilstanden til produksjonen. Og dersom tilstanden i den virkelige verdenen ikke stemmer med kildekoden, vil du bli varslet slik at du f√•r muligheten til √• se forskjellene og fikse problemet.</p> <p>Med andre ord GitOps utvider pipelinen med en feedback loop for observering og kontrollering av systemet.</p></div> <h3 id="weaveworks-flux"><a href="#weaveworks-flux" aria-hidden="true" class="header-anchor">#</a> Weaveworks Flux</h3> <p><a href="https://github.com/weaveworks/flux" target="_blank" rel="noopener noreferrer">Weaveworks Flux<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> er ett verkt√∏y som implementerer GitOps metodikken. Flux blir kj√∏rt inni Kubernetes klusteret og synkroniserer seg med konfigurasjons repository som vi hoster p√• Bitbucket. N√•r en √∏nsker √• gj√∏re endringer i klusteret pusher utvikleren oppdateringene til repo'et og Flux vil lytte p√• endringer og utf√∏re de. Det er lett √• holde kontroll i git loggen hva Flux har gjort for den tagger, og commiter tilbake til repo'et.</p> <p>N√•r en vanlig utvikler pusher kode til ett repo, s√• vil v√•r CI Pipeline i Bitbucket bygge og deploye docker imaget til Azure Container Registry. Da vil Flux laste ned docker imaget og utf√∏re endringene mot klusteret, og oppdatere konfigurasjons repo'et.
<img src="/DAT156/assets/img/deployment-pipeline.904329d6.png" alt="deployment-pipeline"></p> <p>Vi bruker i tillegg Helm for √• kunne dra nytte av templates, package managment, test av distribusjoner og rollbacks osv. Da ser oversikten slik ut:
<img src="/DAT156/assets/img/flux-helm-gitops.10f51dbe.png" alt="flux-helm-gitops"></p> <p>Dette fikk jeg testet og implementert i dag p√• <em>server_location</em> modulen. Og det ser ut som dette kan v√¶re en utrolig god m√•te til √• holde klusteret i sjakk. Bruker vi GitOps riktig vil det ikke v√¶re n√∏dvendig √• aksessere klusteret manuelt for √• gj√∏re endringer. Dette minsker risikoen med at noen klusser til noe. Og at vi alltid har en plass som er sannheten og det er i repo'et.</p> <h3 id="jetstack-cert-manager"><a href="#jetstack-cert-manager" aria-hidden="true" class="header-anchor">#</a> Jetstack Cert-Manager</h3> <p>N√•r vi skal kj√∏re tjenestene v√•re i skyen hos Azure p√• Kubernetes b√∏r vi kryptere trafikken v√•r over HTTPS. Da trenger vi ogs√• TLS sertifikater.</p> <div class="tip custom-block"><p class="custom-block-title">Cert-Manager</p> <p><a href="https://docs.cert-manager.io/en/latest/index.html" target="_blank" rel="noopener noreferrer">Cert-Manager<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> er en kraftig, allsidig sertifikatstyringskontroller for Kubernetes. Verkt√∏yet vil skaffe sertifikaer, fra en rekke utstedere, og s√∏rge for at disse er gyldige og oppdaterte. Og det vil kunne fornye sertifikater p√• en konfigurert tid f√∏r de utl√∏per.</p></div> <p>Vi kommer til √• bruke Let's Encrypt som en utsteder. Let's Encrypt er en gratis, automatisert og √•pen sertifikatautoritet fra non-profit organisasjonen Internet Security Research Group (ISRG).</p> <p>Liten oversikt over hvordan cert-manager virker:</p> <p><img src="/DAT156/assets/img/high-level-overview.89d9975d.png" alt="high-level-overview"></p> <p>Dette fikk jeg ogs√• konfigurert opp i dag og lagt inn i Helm Chartet til <em>dd_server_location</em> modulen.</p> <p>Alt i alt en veldig produktiv dag, men gjort mye research og for arbeid. Men etter flere dager med feils√∏king i gammel Angular kode, var det g√∏y √• g√• over til dette prosjektet igjen.</p> <p>I morgen fortsetter arbeidet videre med √• trekke opp en ny modul i skyen. Denne krever en database tilkobling, s√• her m√• vi finne ut hvor i arkitekturen vi √∏nsker √• plassere den.</p> <h2 id="mandag-tirsdag-og-onsdag"><a href="#mandag-tirsdag-og-onsdag" aria-hidden="true" class="header-anchor">#</a> Mandag, tirsdag og onsdag</h2> <div class="warning custom-block"><p class="custom-block-title">Mad girlfriend bug</p> <p>When you see something strange is happening, but the software is telling you everything is fine.</p></div> <p>Har jobbet parallelt med flere oppgaver denne uken. I hovedsak har jeg jobbet med daglige oppgaver fra teamet mitt sin Kanban tavle, siden sky-prosjektet har en liten pause. Vi har nettopp tatt en <em>cut fra master</em> som blir en leveranse til Eika. Denne har ett par saker som er blitt meldt inn fra kunden selv, og noen saker som testerne v√•re har meldt inn. P√• fredag fant jeg noen feil ogs√•, som jeg har jobbet med denne uken.</p> <p>En sak jeg har sett p√• handlet om renderingen av en komponent i en av klientene som feilet n√•r siden ble lastet i en ren nettleser. Med ren nettleser mener jeg at det ikke ligger noe cache som <em>localStorage</em> og <em>sessionStorage</em>, samt ingen cookies.</p> <p>Det har v√¶rt en frustrerende oppgave, for feilen ligger gjemt i klient koden. Alt p√• server siden var i orden. Til slutt var det flere p√• teamet som s√• p√• problemet. Til slutt viste det seg at kallene som gikk for √• hente <code>i18n</code> tekstene som skal vises i klienten feilet, fordi de URL'en de gikk mot ikke var riktige. Dette resulterte i mange andre snodige feil, som gjorde at feilen s√• ut til √• v√¶re noe den slett ikke skulle v√¶re.</p> <p>Ellers har jeg hjupet en ny student som har begynt √• jobbe hos oss med √• sette opp noen API tester i Postman for √• kj√∏re e2e-tester (ende til ende).</p> <p>Ogs√• har jeg jobbet en del med en pipeline for JWT prosjektet, slik at ting blir bygget opp i Azure Artifacts.</p> <p>I dag (Onsdag) fikk jeg endelig en prat med en av arkitektene som har v√¶rt med meg p√• <em>Veien mot skyene</em> prosjektet, for √• ta en status p√• hvordan prosjeket ligger an siden jeg skal fortsette med prosjektet fra i morgen av.</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Sist oppdatert: </span> <span class="time">2/9/2019, 2:59:20 PM</span></div></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/DAT156/uke5/">
          Uke 5 - JWT
        </a>
        ‚Üí
      </span></p></div> </div> <!----></div></div>
    <script src="/DAT156/assets/js/app.6c68b4e0.js" defer></script><script src="/DAT156/assets/js/4.fe756608.js" defer></script>
  </body>
</html>
